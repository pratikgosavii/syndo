{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quotation Invoice - {{ quotation.invoice_number }}</title>
  <style>
    @page {
      size: A4;
      margin: 15mm;
    }
    body {
      font-family: Arial, sans-serif;
      font-size: 12px;
      color: #000;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #000;
      padding: 5px;
      text-align: center;
    }
    .no-border td, .no-border th {
      border: none !important;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid #000;
      padding-bottom: 5px;
    }
    .header-left {
      text-align: left;
    }
    .header-right {
      text-align: right;
    }
    .section {
      margin-top: 8px;
      border: 1px solid #000;
      padding: 4px;
    }
    .signature {
      margin-top: 40px;
      text-align: right;
      font-weight: bold;
    }
    .small-text {
      font-size: 11px;
    }
  </style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <img src="{% static 'images/logo.png' %}" width="60"><br>
    <strong>{{ company.name }}</strong><br>
    {{ company.address_line1 }}<br>
    {{ company.address_line2 }}<br>
    GSTIN : {{ company.gstin }} | PAN : {{ company.pan }}<br>
    Mobile : {{ company.phone }} | Email : {{ company.email }}
  </div>
  <div class="header-right">
    <h3 style="color:blue; margin:0;">QUOTATION</h3>
    <p><strong>Original for Recipient</strong></p>
    Quotation Date : {{ quotation.date|date:"d/m/Y" }} <br>
    Invoice No. : {{ quotation.invoice_number }}
  </div>
</div>

<!-- Customer Details -->
<table class="section">
  <tr>
    <td width="40%">
      <strong>Customer Details:</strong><br>
      {{ customer.name }}<br>
      GSTIN : {{ customer.gstin }}<br>
      PAN : {{ customer.pan }}<br>
      Aadhar : {{ customer.aadhar }}<br>
      Ph : {{ customer.phone }}
    </td>
    <td width="30%">
      <strong>Billing Address :</strong><br>
      {{ customer.billing_address }}
      <br><br>
      <strong>Delivery Address :</strong><br>
      {{ customer.delivery_address }}
    </td>
    <td width="30%">
      <strong>Reference :</strong> {{ quotation.reference }}
    </td>
  </tr>
</table>

<!-- Items Table -->
<table>
  <thead>
    <tr>
      <th>S.No.</th>
      <th>Item</th>
      <th>HSN/SAC</th>
      <th>Rate</th>
      <th>Qty Unit</th>
      <th>Taxable Value</th>
      <th colspan="2">GST</th>
      <th>Total</th>
    </tr>
    <tr>
      <th colspan="6"></th>
      <th>SGST(%)</th>
      <th>CGST(%)</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for item in quotation.items.all %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td>{{ item.product.name }}</td>
      <td>{{ item.product.hsn_sac }}</td>
      <td>{{ item.rate|floatformat:2 }}</td>
      <td>{{ item.quantity }}</td>
      <td>{{ item.taxable_value|floatformat:2 }}</td>
      <td>{{ item.sgst_rate }}%</td>
      <td>{{ item.cgst_rate }}%</td>
      <td>{{ item.total|floatformat:2 }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Totals Section -->
<table class="no-border">
  <tr>
    <td width="60%">
      <strong>Total Quantity :</strong> {{ quotation.total_qty }} <br>
      <strong>Total value in words :</strong> {{ quotation.total_in_words }}
    </td>
    <td width="40%">
      <table>
        <tr><td>Taxable Amount</td><td>{{ quotation.taxable_amount|floatformat:2 }}</td></tr>
        <tr><td>SGST</td><td>{{ quotation.sgst_amount|floatformat:2 }}</td></tr>
        <tr><td>CGST</td><td>{{ quotation.cgst_amount|floatformat:2 }}</td></tr>
        <tr><td>Discount ({{ quotation.discount_rate }}%)</td><td>{{ quotation.discount_amount|floatformat:2 }}</td></tr>
        <tr><td>Delivery Charges</td><td>{{ quotation.delivery_charges|floatformat:2 }}</td></tr>
        <tr><td>Package Charges</td><td>{{ quotation.package_charges|floatformat:2 }}</td></tr>
        <tr><td>Round off</td><td>{{ quotation.round_off|floatformat:2 }}</td></tr>
        <tr><td><strong>Total Amount</strong></td><td><strong>{{ quotation.total_amount|floatformat:2 }}</strong></td></tr>
        <tr><td>Paid</td><td>{{ quotation.paid|floatformat:2 }}</td></tr>
        <tr><td><strong>Balance</strong></td><td><strong>{{ quotation.balance|floatformat:2 }}</strong></td></tr>
      </table>
    </td>
  </tr>
</table>

<!-- Bank + QR -->
<table>
  <tr>
    <td width="60%">
      <strong>Bank Details :</strong><br>
      Bank : {{ company.bank_name }}<br>
      Account No : {{ company.account_no }}<br>
      IFSC : {{ company.ifsc }}<br>
      Branch : {{ company.branch }}<br>
      UPI : {{ company.upi_id }}
    </td>
    <td width="40%" align="center">
      <img src="{% static 'images/qr.png' %}" width="100"><br>
      <small>Pay using UPI</small>
    </td>
  </tr>
</table>

<!-- HSN Summary -->
<table>
  <thead>
    <tr>
      <th>HSN / SAC</th>
      <th>Taxable Value</th>
      <th>SGST(%)</th>
      <th>Amount</th>
      <th>CGST(%)</th>
      <th>Amount</th>
      <th>Total Tax Amount</th>
    </tr>
  </thead>
  <tbody>
    {% for tax in quotation.hsn_summary %}
    <tr>
      <td>{{ tax.hsn }}</td>
      <td>{{ tax.taxable_value|floatformat:2 }}</td>
      <td>{{ tax.sgst_rate }}%</td>
      <td>{{ tax.sgst_amount|floatformat:2 }}</td>
      <td>{{ tax.cgst_rate }}%</td>
      <td>{{ tax.cgst_amount|floatformat:2 }}</td>
      <td>{{ tax.total_tax|floatformat:2 }}</td>
    </tr>
    {% endfor %}
    <tr>
      <td colspan="6"><strong>Total</strong></td>
      <td><strong>{{ quotation.total_tax|floatformat:2 }}</strong></td>
    </tr>
  </tbody>
</table>

<p><strong>Notes:</strong> {{ quotation.notes }}</p>
<p><strong>Terms & Conditions:</strong><br>{{ quotation.terms|linebreaks }}</p>

<div class="signature">Authorized Signature</div>

</body>
</html>
