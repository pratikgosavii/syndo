{% load static %}
{% load num_to_words %}

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Invoice - {{ wholesale.invoice_number }}</title>
<style>
    body {
        font-family: Arial, sans-serif;
        font-size: 12px;
        margin: 0;
        padding: 0;
        color: #000;
    }
    .invoice-box {
        width: 800px;
        margin: auto;
        border: 1px solid #000;
        padding: 15px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
    }
    th, td {
        border: 1px solid #000;
        padding: 6px;
        vertical-align: top;
    }
    .no-border td {
        border: none !important;
        padding: 2px;
    }
    .header-title {
        text-align: center;
        font-weight: bold;
        color: blue;
        padding: 5px;
    }
    .company-logo {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: #ccc;
        text-align: center;
        line-height: 50px;
        font-size: 12px;
        margin-right: 10px;
    }
    .summary td {
        border: none;
        text-align: right;
        padding: 3px 6px;
    }
    .terms {
        height: 60px;
        font-size: 11px;
    }
    .footer {
        text-align: center;
        font-size: 11px;
        margin-top: 5px;
    }
    .bold { font-weight: bold; }
</style>
</head>
<body>

<div class="invoice-box">

    <!-- Title -->
    <table class="no-border">
        <tr><td class="header-title">INVOICE</td></tr>
    </table>

    <!-- Company Info -->
    <table class="no-border">
        <tr>
            <td style="width:60px;">
                {% if sale_instance.company_profile and sale_instance.company_profile.profile_image %}
                    <img src="{{ sale_instance.company_profile.profile_image.url }}" width="50" height="50">
                {% else %}
                    <div class="company-logo">Logo</div>
                {% endif %}
            </td>
            <td>
                <div class="bold">{{ sale_instance.company_profile.company_name }}</div>
                {{ sale_instance.company_profile.address_line_1 }}<br>
                {{ sale_instance.company_profile.address_line_2 }}<br>
            </td>
            <td style="text-align:right;">
                <b>Invoice Date:</b> {{ wholesale.date|date:"d/m/Y" }}<br>
                <b>Invoice No.:</b> {{ wholesale.invoice_number }}<br>
                <b>Due Date:</b> {{ wholesale.date|date:"d/m/Y" }}
            </td>
        </tr>
    </table>

    <!-- Customer Info -->
    <table>
        <tr>
            <td><b>Customer Name :</b> {{ sale_instance.customer.name }}</td>
            <td><b>Mobile No :</b> {{ sale_instance.customer.contact }}</td>
        </tr>
    </table>

    <!-- Product Table -->
    <table>
        <thead>
            <tr>
                <th style="width:5%;">S.No.</th>
                <th style="width:45%;">Product / Service</th>
                <th style="width:10%;">Price</th>
                <th style="width:10%;">Tax</th>
                <th style="width:10%;">Qty</th>
                <th style="width:10%;">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in sale_instance.items.all %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>
                    {% if item.product %}{{ item.product.name }}{% else %}N/A{% endif %}<br>
                    {% if item.product %}
                        {% if item.product.size %}size - {{ item.product.size }}{% endif %}
                        {% if item.product.color %}{% if item.product.size %}, {% endif %}color - {{ item.product.color }}{% endif %}
                        {% if item.product.brand_name %}, brand - {{ item.product.brand_name }}{% endif %}
                    {% endif %}
                </td>
                <td>{{ item.price }}</td>
                <td>{{ item.tax_amount|default:"0" }}</td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.amount|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="6">No items found.</td></tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                <td colspan="5" class="bold">Total</td>
                <td class="bold">{{ sale_instance.total_amount|floatformat:2 }}</td>
            </tr>
        </tfoot>
    </table>

    <!-- Total Value + QR + Summary -->
    <table>
        <tr>
            <td style="width:40%;"><b>Total value in words :</b> {{ sale_instance.total_amount|in_words }}</td>
            <td style="width:25%; text-align:center;">
                {% if sale_instance.company_profile.payment_qr %}
                    <img src="{{ sale_instance.company_profile.payment_qr.url }}" width="80" height="80"><br>
                {% else %}
                    <img src="{% static 'qr.png' %}" width="80" height="80"><br>
                {% endif %}
                Pay using UPI
            </td>
            <td style="width:35%;">
                <table class="summary" style="width:100%;">
                    <tr><td>Discount ({{ sale_instance.discount_percentage }}%)</td></tr>
                    <tr class="bold"><td>Total Amount: â‚¹ {{ sale_instance.total_amount|floatformat:2 }}</td></tr>
                </table>
            </td>
        </tr>
        <tr>
            <td colspan="2" class="terms"><b>Terms & Conditions</b><br>{{ wholesale.terms|default:"" }}</td>
            <td style="text-align:right; vertical-align:bottom;">Signature</td>
        </tr>
    </table>

</div>

<div class="footer">
    Website - {{ sale_instance.company_profile.website|default:"www.companydomain.com" }}<br>
    Page no. 1
</div>

</body>
</html>
