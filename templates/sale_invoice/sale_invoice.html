{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Delivery Challan - {{ wholesale.invoice_number }}</title>
    <style>
        /* Your existing CSS here */
        body {
            font-family: Arial, sans-serif;
            font-size: 13px;
            color: #000;
            margin: 30px;
        }
        /* ... rest of your CSS unchanged ... */
        .container {
            width: 100%;
            border: 1px solid #000;
            padding: 10px;
        }
        .row {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        .col {
            flex: 1;
            padding: 5px;
        }
        .header {
            border-bottom: 1px solid #000;
            padding-bottom: 10px;
        }
        .header .col {
            flex: 1;
        }
        .table, .summary-table, .hsn-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0px !important;
        }
        .table th, .table td,
        .summary-table th, .summary-table td,
        .hsn-table th, .hsn-table td {
            border: 1px solid #000;
            padding: 5px;
            text-align: center;
        }
        .section {
            margin-top: 10px;
        }
        .bold {
            font-weight: bold;
        }
        .right {
            text-align: right;
        }
        .signature {
            margin-top: 30px;
            text-align: right;
        }
        .note, .terms {
            margin-top: 10px;
        }
        .qr-bank {
            display: flex;
        }
        .qr-bank .col {
            flex: 1;
        }
        .qr {
            text-align: center;
        }
        .row.with-lines .col {
            position: relative;
            padding: 10px;
            flex: 1;
        }
        /* Add vertical divider */
       .row.with-lines .col:not(:first-child) {
    border-left: 1px solid #000;
}

        .section {
            margin-top: 0 !important;
        }
        .table {
            margin-top: 0 !important;
            padding-top: 10px !important;
        }
        

        .container {
    padding: 0px !important;
}


.page {
    margin: 30px;
}

.container {
    width: 100%;
    border: 1px solid #000;
    box-sizing: border-box;
    padding: 10px;
}


.table {
    margin-top: 0px !important;
}

    </style>
</head>
<body>
  <div class="page">
    <div class="container">
    <div class="row header">
        <div class="col" style="text-align: center;">
            {% if sale_instance.company_profile and sale_instance.company_profile.profile_image %}
                <img src="{{ sale_instance.company_profile.profile_image.url }}" alt="Logo" width="60" height="60">
            {% else %}
                <img src="{% static 'logo.png' %}" alt="Logo" width="60" height="60">
            {% endif %}
        </div>
        <div class="col">
            <div class="bold">{{ sale_instance.company_profile.name }}</div>
            {{ sale_instance.company_profile.address_line1 }}<br>
            {{ sale_instance.company_profile.address_line2 }}<br>
            GSTIN : {{ sale_instance.company_profile.gstin }} &nbsp; PAN : {{ sale_instance.company_profile.pan }}<br>
            Mobile : {{ sale_instance.company_profile.mobile }} &nbsp; Email : {{ sale_instance.company_profile.email }}<br>
            <div class="bold">Reverse Charge</div>
        </div>
        <div class="col" style="text-align: right;">
            <div class="bold" style="color:blue;">DELIVERY CHALLAN</div>
            <div>ORIGINAL FOR RECIPIENT</div>
            Challan Date: {{ wholesale.date|date:"d/m/Y" }}<br>
            Challan No: {{ wholesale.invoice_number }}<br>
        </div>
    </div>

    <div class="row section with-lines">
        <div class="col">
            <div class="bold">Customer Details:</div>
            {{ sale_instance.customer.name }}<br>
            GSTIN : {{ sale_instance.customer.gstin }}<br>
            PAN : {{ sale_instance.customer.pan }}<br>
            Aadhar : {{ sale_instance.customer.aadhar }}<br>
            Ph : {{ sale_instance.customer.phone }}
        </div>
        <div class="col">
            <div class="bold">Billing Address:</div>
            {{ sale_instance.customer.billing_address_line1 }}<br>
            {{ sale_instance.customer.billing_address_line2 }}
        </div>
        <div class="col">
            <div class="bold">Delivery Address:</div>
            {{ wholesale.dispatch_address|default:"Address line 1" }}<br>
            {{ wholesale.delivery_city|default:"Address line 2" }}
        </div>
        <div class="col">
            <div><b>Reference :</b> {{ wholesale.references|default:"N/A" }}</div>
            <div><b>Due Date :</b> {{ sale_instance.credit_time_days|date:"d/m/Y" }}</div>
            <div><b>No. of Parcels :</b> {{ wholesale.number_of_parcels|default:"N/A" }}</div>
            <div><b>Delivery City :</b> {{ wholesale.delivery_city|default:"N/A" }}</div>
        </div>

        
    </div>

    <table class="table">
        <thead>
            <tr>
                <th>S.No.</th>
                <th>Item</th>
                <th>HSN/SAC</th>
                <th>Rate</th>
                <th>Qty</th>
                <th>Unit</th>
                <th>Taxable Value</th>
                <th>SGST(%)</th>
                <th>CGST(%)</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in sale_instance.items.all %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ item.product.name }}</td>
                <td>{{ item.product.hsn_code }}</td>
                <td>{{ item.price }}</td>
                <td>{{ item.quantity }}</td>
                <td>{{ item.product.unit|default:"PCS" }}</td>
                <td>{{ item.amount }}</td>
                <td>{{ item.product.sgst_rate|default:"9%" }}</td>
                <td>{{ item.product.cgst_rate|default:"9%" }}</td>
                <td>{{ item.amount|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="10">No items found.</td></tr>
            {% endfor %}
        </tbody>
    </table>

    <div style="border: 1px solid #000; border-top: none; border-left: none; border-bottom: none;">
  <div style="display: flex;">
    <!-- Left: Bank Details -->
    <div style="flex: 1; border-right: 1px solid #000;">
        <div style="border-bottom: 1px solid black;
    padding: 10px;">
        <div class="bold">Total Quantity : {{ sale_instance.total_items }}</div>
        <div class="bold">Total value in words : {{ total_amount }} Only</div>
        </div>
        <div style="padding: 10px;">
            <div class="bold">Bank Details :</div>
            Bank : {{ sale_instance.company_profile.bank_name|default:"N/A" }}<br>
            Account No. : {{ sale_instance.company_profile.bank_account_number|default:"N/A" }}<br>
            IFSC Code : {{ sale_instance.company_profile.ifsc_code|default:"N/A" }}<br>
            Branch : {{ sale_instance.company_profile.bank_branch|default:"N/A" }}<br>
            UPI Id : {{ sale_instance.company_profile.upi_id|default:"N/A" }}
            </div>
        </div>

    <!-- Center: QR Code -->
    <div style="width: 120px; display: flex; align-items: center; justify-content: center; border-right: 1px solid #000;">
      {% if sale_instance.company_profile.payment_qr %}
          <img src="{{ sale_instance.company_profile.payment_qr.url }}" alt="QR Code" width="80" height="80">
      {% else %}
          <img src="{% static 'qr.png' %}" alt="QR Code" width="80" height="80">
      {% endif %}
    </div>

    <!-- Right: Tax Summary -->
    <div style="flex: 1;">
      <div class="bold" style="border-bottom: 1px solid #000; padding-bottom: 5px;"><div style="padding:10px"> Taxable Amount </div> </div>
        <div style="padding: 10px;">

            SGST<br>
            CGST<br>
            Discount ({{ sale_instance.discount_percentage }}%)<br>
            Delivery Charges<br>
            Package Charges<br>
            Round off<br>
        </div>
        <div class="bold" style="border-top: 1px solid #000; margin-top: 5px; padding-top: 5px;">
            <div style="padding: 10px;">

            Total Amount: â‚¹ {{ total_amount|floatformat:2 }}
        
            Paid<br>
            <div class="bold" style="color: red;">Balance</div>
        </div>
        </div>
    </div>
    </div>
  </div>
</div>


   
    <table class="hsn-table">
        <thead>
            <tr>
                <th>HSN / SAC</th>
                <th>Taxable Value</th>
                <th>SGST(%)</th>
                <th>Amount</th>
                <th>CGST(%)</th>
                <th>Amount</th>
                <th>Total Tax Amount</th>
            </tr>
        </thead>
        <tbody>
    {% for hsn, data in hsn_summary %}
    <tr>
        <td>{{ hsn }}</td>
        <td>{{ data.taxable_value|floatformat:2 }}</td>
        <td>{{ data.sgst_rate }}%</td>
        <td>{{ data.sgst_amount|floatformat:2 }}</td>
        <td>{{ data.cgst_rate }}%</td>
        <td>{{ data.cgst_amount|floatformat:2 }}</td>
        <td>{{ data.total_tax|floatformat:2 }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="7">No HSN data available</td></tr>
    {% endfor %}
</tbody>
    </table>

    <div class="note">
        <b>Notes:</b> {{ wholesale.notes|default:"-" }}
    </div>
    <div class="terms">
        <b>Terms & Conditions:</b><br>
        {{ wholesale.terms|linebreaksbr|default:"-" }}
    </div>

    <div class="signature">
        {% if wholesale.signature %}
            <img src="{{ wholesale.signature.url }}" alt="Signature" width="120" height="60"><br>
        {% endif %}
        <b>Authorized Signature</b><br>
        Page no. 1/1
    </div>
</div>
</div>
</body>
</html>
