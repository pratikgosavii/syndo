<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quotation</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 13px;
      margin: 0;
      padding: 0;
    }

    .container {
      border: 2px solid #007bff; /* Blue border */
      margin: 10px;
      padding: 10px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      border-bottom: 1px solid black;
      padding-bottom: 5px;
    }

    .logo {
      width: 70px;
      height: 70px;
      background: #ccc;
      border-radius: 50%;
      text-align: center;
      line-height: 70px;
      font-weight: bold;
    }

    .company-details {
      flex-grow: 1;
      margin-left: 10px;
    }

    .company-details h2 {
      margin: 0;
      font-size: 16px;
    }

    .quotation {
      text-align: right;
      font-size: 13px;
    }

    .quotation h3 {
      margin: 0;
      color: #007bff;
    }

    .details, .items, .summary, .tax-summary {
      width: 100%;
      border-collapse: collapse;
      margin-top: 5px;
    }

    .details td, .items th, .items td, .tax-summary th, .tax-summary td {
      border: 1px solid black;
      padding: 4px;
      vertical-align: top;
    }

    .items th {
      text-align: center;
      background: #f2f2f2;
    }

    .summary td {
      border: none;
      padding: 2px 4px;
    }

    .bank-details {
      border: 1px solid black;
      padding: 5px;
      margin-top: 5px;
    }

    .qr {
      float: right;
      width: 80px;
      height: 80px;
      background: #ddd;
    }

    .footer {
      margin-top: 10px;
      font-size: 12px;
    }

    .footer strong {
      display: block;
      margin-top: 5px;
    }

    .signature {
      text-align: right;
      margin-top: 20px;
      font-weight: bold;
    }

    .page-no {
      text-align: right;
      font-size: 12px;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="logo">
        {% if sale_instance.company_profile and sale_instance.company_profile.profile_image %}
        <img src="{{ sale_instance.company_profile.profile_image.url }}" alt="Logo" style="width:70px;height:70px;border-radius:50%;object-fit:cover;" />
        {% else %}Logo{% endif %}
      </div>
      <div class="company-details">
        <h2>{{ sale_instance.company_profile.company_name|default:sale_instance.company_profile.brand_name }}</h2>
        {% if sale_instance.company_profile.address_line_1 %}{{ sale_instance.company_profile.address_line_1 }}<br>{% endif %}
        {% if sale_instance.company_profile.address_line_2 %}{{ sale_instance.company_profile.address_line_2 }}<br>{% endif %}
        GSTIN : {{ sale_instance.company_profile.gstin|default:"-" }} &nbsp;&nbsp; PAN : {{ sale_instance.company_profile.pan|default:"-" }}<br>
        Mobile : {{ sale_instance.company_profile.contact|default:"-" }} &nbsp;&nbsp; Email : {{ sale_instance.company_profile.email|default:"-" }}<br>
        {% if wholesale.reverse_charges %}<b>Reverse Charge</b>{% endif %}
      </div>
      <div class="quotation">
        <h3>Delivery Challan (IGST)</h3>
        ORIGINAL FOR RECIPIENT<br>
        Date: {{ wholesale.date|default:sale_instance.created_at|date:"d/m/Y" }}<br>
        No: {{ wholesale.invoice_number }}
      </div>
    </div>

    <!-- Customer Details -->
    <table class="details">
      <tr>
        <td width="33%">
          <b>Customer Details:</b><br>
          {{ sale_instance.customer.company_name|default:sale_instance.customer.name }}<br>
          GSTIN : {{ sale_instance.customer.gst_number|default:"-" }}<br>
          PAN : {{ sale_instance.customer.pan_number|default:"-" }}<br>
          Aadhar : {{ sale_instance.customer.aadhar_number|default:"-" }}<br>
          Ph : {{ sale_instance.customer.contact|default:"-" }}
        </td>
        <td width="33%">
          <b>Billing Address :</b><br>
          {% if sale_instance.customer.billing_address_line1 %}{{ sale_instance.customer.billing_address_line1 }}<br>{% endif %}
          {% if sale_instance.customer.billing_address_line2 %}{{ sale_instance.customer.billing_address_line2 }}<br>{% endif %}
          <b>Delivery Address :</b><br>
          {% if sale_instance.customer.dispatch_address_line1 %}{{ sale_instance.customer.dispatch_address_line1 }}<br>{% endif %}
          {% if sale_instance.customer.dispatch_address_line2 %}{{ sale_instance.customer.dispatch_address_line2 }}<br>{% endif %}
        </td>
        <td>
          <b>Reference :</b> {{ wholesale.references|default:"-" }}
        </td>
      </tr>
    </table>

    <!-- Item Table -->
    <table class="items">
      <tr>
        <th>S.No.</th>
        <th>Item</th>
        <th>HSN/SAC</th>
        <th>Rate</th>
        <th>Qty Unit</th>
        <th>Taxable Value</th>
        <th>IGST (%)</th>
        <th>Total</th>
      </tr>
      {% for item in sale_instance.items.all %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ item.product.name }}</td>
        <td>{{ item.product.hsn|default:"-" }}</td>
        <td>{{ item.price|floatformat:2 }}</td>
        <td>{{ item.quantity }}</td>
        <td>{{ item.amount|floatformat:2 }}</td>
        <td>{{ item.product.gst|default:"0" }}%</td>
        <td>{{ item.total_with_tax|floatformat:2 }}</td>
      </tr>
      {% endfor %}
    </table>

    <!-- Summary -->
    <table class="summary">
      <tr>
        <td width="50%">
          <b>Total Quantity :</b> {{ total_quantity }}<br>
          <b>Total value in words :</b> {{ total_in_words }}
        </td>
        <td width="50%">
          <table style="width:100%">
            <tr><td>Taxable Amount</td><td class="text-right">{{ sum_taxable|floatformat:2 }}</td></tr>
            <tr><td>IGST</td><td class="text-right">{{ sum_igst|floatformat:2 }}</td></tr>
            <tr><td>Discount ({{ discount_percentage|default:"0" }}%)</td><td class="text-right">{{ discount_amount|floatformat:2 }}</td></tr>
            <tr><td>Delivery Charges</td><td class="text-right">{{ wholesale.delivery_charges|default:"0.00" }}</td></tr>
            <tr><td>Package Charges</td><td class="text-right">{{ wholesale.packaging_charges|default:"0.00" }}</td></tr>
            <tr><td><b>Round off</b></td><td class="text-right">{{ round_off_value|floatformat:2 }}</td></tr>
            <tr><td><b>Total Amount</b></td><td class="text-right"><b>{{ rounded_total|floatformat:2 }}</b></td></tr>
            <tr><td>Paid</td><td class="text-right">{{ paid_amount|floatformat:2 }}</td></tr>
            <tr><td><b>Balance</b></td><td class="text-right"><b>{{ balance_amount|floatformat:2 }}</b></td></tr>
          </table>
        </td>
      </tr>
    </table>

    <!-- Bank Details -->
    <div class="bank-details">
      <b>Bank Details :</b><br>
      Bank : {{ sale_instance.advance_bank.name|default:"-" }}<br>
      Account No : {{ sale_instance.advance_bank.account_number|default:"-" }}<br>
      IFSC Code : {{ sale_instance.advance_bank.ifsc_code|default:"-" }}<br>
      Branch : {{ sale_instance.advance_bank.branch|default:"-" }}<br>
      UPI Id : {{ sale_instance.company_profile.upi_id|default:"-" }}
      <div class="qr">
        {% if sale_instance.company_profile.payment_qr %}
        <img src="{{ sale_instance.company_profile.payment_qr.url }}" alt="QR" style="width:80px;height:80px;object-fit:cover;" />
        {% else %}QR{% endif %}
      </div>
    </div>

    <!-- Tax Summary -->
    <table class="tax-summary">
      <tr>
        <th>HSN / SAC</th>
        <th>Taxable Value</th>
        <th>IGST(%)</th>
        <th>Amount</th>
        <th>Total Tax Amount</th>
      </tr>
      {% for hsn, data in hsn_summary %}
      <tr>
        <td height="40">{{ hsn }}</td>
        <td>{{ data.taxable_value|floatformat:2 }}</td>
        <td>{{ data.igst_rate|default:"0" }}%</td>
        <td>{{ data.igst_amount|floatformat:2 }}</td>
        <td>{{ data.total_tax|floatformat:2 }}</td>
      </tr>
      {% endfor %}
      <tr>
        <td colspan="4" style="text-align:right"><b>Total</b></td>
        <td>{{ sum_igst|floatformat:2 }}</td>
      </tr>
    </table>

    <!-- Footer -->
    <div class="footer">
      <strong>Notes:</strong> {{ wholesale.notes|default:"-" }}
      <strong>Terms & Conditions:</strong>
      {{ wholesale.terms|default:"-" }}
    </div>

    <div class="signature">Authorized Signature</div>
    <div class="page-no">Page no. 1/1</div>
  </div>
</body>
</html>
