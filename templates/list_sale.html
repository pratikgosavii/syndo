{% extends "partials/adminBase.html" %}
{% load static %}

{% block title %}Sale Ledger{% endblock title %}

{% block extra_css %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>
    <style>
        body { background-color: #f1f5f9; color: #334155; font-size: 0.8125rem; }
        .ledger-page .page-title { font-weight: 700; color: #1e293b; font-size: 1.2rem; margin-bottom: 0.75rem; margin-top: 0.75rem; }
        .ledger-page .summary-card {
            background: #151e31;
            border-radius: 8px;
            padding: 0.85rem 1.1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(26, 115, 232, 0.25);
        }
        .ledger-page .summary-card .label { font-size: 0.65rem; font-weight: 600; text-transform: uppercase; color: rgba(255,255,255,0.9); letter-spacing: 0.05em; }
        .ledger-page .summary-card .value { font-size: 1.35rem; font-weight: 700; color: #fff; }
        .ledger-page .summary-card .icon-wrap {
            width: 34px; height: 34px;
            background: #fef3c7;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #d97706;
            font-size: 0.9rem;
        }
        .ledger-page .filter-bar {
            background: #e8eaed;
            border-radius: 10px;
            padding: 0.5rem 0.85rem;
            margin-bottom: 0.75rem;
            box-shadow: 0 1px 2px rgba(0,0,0,0.06);
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.4rem;
        }
        .ledger-page .filter-bar .filter-input {
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            padding: 0.3rem 0.5rem;
            font-size: 0.8rem;
            color: #3c4043;
        }
        .ledger-page .filter-bar .filter-input::placeholder { color: #9aa0a6; }
        .ledger-page .filter-bar .filter-date { min-width: 118px; }
        .ledger-page .filter-bar .filter-to { color: #5f6368; font-size: 0.8rem; padding: 0 0.2rem; }
        .ledger-page .filter-bar .filter-select {
            min-width: 110px;
            background: #fff;
            border: 1px solid #dadce0;
            border-radius: 6px;
            padding: 0.3rem 0.5rem;
            font-size: 0.8rem;
            color: #3c4043;
            appearance: auto;
        }
        .ledger-page .filter-bar .filter-search { flex: 1; min-width: 160px; max-width: 280px; }
        .ledger-page .filter-bar .btn-search {
            background: #1e293b;
            color: #fff;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            padding: 0.35rem 0.85rem;
            font-size: 0.8rem;
        }
        .ledger-page .filter-bar .btn-search:hover { background: #334155; color: #fff; }
        .ledger-page .btn-add {
            background: #FFC107;
            color: #1e293b;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            padding: 0.35rem 0.85rem;
            font-size: 0.8rem;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            text-decoration: none;
        }
        .ledger-page .btn-add:hover { background: #e6ac00; color: #1e293b; }
        .ledger-page .entry-card {
            background: #fff;
            border-radius: 8px;
            padding: 0.65rem 1rem;
            margin-bottom: 0.65rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
        }
        .ledger-page .entry-card .col-date { min-width: 90px; }
        .ledger-page .entry-card .date-bold { font-weight: 700; color: #1e293b; font-size: 0.85rem; }
        .ledger-page .entry-card .id-badge {
            display: inline-block;
            background: #e0f2fe;
            color: #0369a1;
            padding: 0.15rem 0.4rem;
            border-radius: 5px;
            font-size: 0.72rem;
            margin-top: 0.2rem;
        }
        .ledger-page .entry-card .col-customer { min-width: 120px; }
        .ledger-page .entry-card .col-label { font-size: 0.65rem; font-weight: 600; text-transform: uppercase; color: #64748b; }
        .ledger-page .entry-card .customer-name { font-weight: 700; color: #1e293b; font-size: 0.85rem; }
        .ledger-page .entry-card .ref-text { font-size: 0.78rem; color: #64748b; }
        .ledger-page .entry-card .col-amounts { text-align: right; font-size: 0.8rem; }
        .ledger-page .entry-card .amount-total { font-weight: 700; color: #1e293b; font-size: 0.85rem; }
        .ledger-page .entry-card .amount-paid { font-weight: 600; color: #16a34a; font-size: 0.8rem; }
        .ledger-page .entry-card .amount-due { font-weight: 600; font-size: 0.8rem; }
        .ledger-page .entry-card .amount-due.has-due { color: #dc2626; }
        .ledger-page .entry-card .amount-due.zero { color: #64748b; }
        .ledger-page .entry-card .action-col {
            /* flex: 0.4; */
            min-width: 90px;
            display: flex;
            /* flex-direction: column; */
            gap: 0.5rem;
            align-items: flex-end;
        }
        .ledger-page .btn-view-ledger {
            background: #fef3c7 !important;
            color: #b45309 !important;
            border: none !important;
            font-size: 0.7rem;
            padding: 0.25rem 0.4rem;
            border-radius: 4px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.2rem;
        }
        .ledger-page .btn-view-ledger:hover { background: #fde68a !important; color: #b45309 !important; }
        .ledger-page .action-btns { display: flex; gap: 0.25rem; }
        .ledger-page .action-btn {
            width: 26px;
            height: 26px;
            font-size: 0.75rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            border: 1px solid #e5e7eb;
            background: #fff;
            color: #6b7280;
            text-decoration: none;
            transition: background 0.2s, color 0.2s;
        }
        .ledger-page .action-btn:hover { background: #f9fafb; color: #111; }
        .ledger-page .action-btn.edit:hover { color: #FCA311; }
        .ledger-page .action-btn.delete:hover { color: #ef4444; }
    </style>
{% endblock extra_css %}

{% block content %}
<div class="main-content ledger-page">
    <div class="page-content">
        <div class="container-fluid">
            <div class="container">
                <h2 class="page-title">Sale Ledger</h2>

                <div class="summary-card">
                    <div>
                        <div class="label">Total Sale Value</div>
                        <div class="value">₹ {{ total_sale_value|default:0|floatformat:2 }}</div>
                    </div>
                    <div class="icon-wrap"><i class="bi bi-currency-rupee"></i></div>
                </div>

                <div class="filter-bar">
                    <form method="get" action="" class="d-flex flex-wrap align-items-center gap-2 flex-grow-1">
                        <input type="date" name="date_from" value="{{ date_from }}" class="filter-input filter-date" placeholder="mm/dd/yyyy">
                        <span class="filter-to">to</span>
                        <input type="date" name="date_to" value="{{ date_to }}" class="filter-input filter-date" placeholder="mm/dd/yyyy" title="End date">
                        <select name="filter_type" class="filter-input filter-select">
                            <option value="">All Types</option>
                            <option value="wholesale" {% if filter_type == 'wholesale' %}selected{% endif %}>Wholesale</option>
                            <option value="retail" {% if filter_type == 'retail' %}selected{% endif %}>Retail</option>
                        </select>
                        <input type="text" name="search" value="{{ search }}" class="filter-input filter-search" placeholder="Search Invoice ID, Customer Name or Phone...">
                        <button type="submit" class="btn-search">Search</button>
                    </form>
                    <a href="{% url 'create-sale' %}" class="btn-add ms-auto"><i class="bi bi-plus-lg"></i> Add Sale</a>
                </div>

                {% for sale in data %}
                <div class="entry-card">
                    <div class="col-date">
                        <div class="date-bold">{{ sale.created_at|date:"M d, Y" }}</div>
                        <span class="id-badge">#{{ sale.invoice_number|default:sale.id }}</span>
                    </div>
                    <div class="col-customer">
                        <div class="col-label">Customer</div>
                        <div class="customer-name">{{ sale.customer.name|default:"Walk-in" }}</div>
                        <div class="ref-text">Ref: {{ sale.invoice_number|default:"—" }}</div>
                    </div>
                    <div class="col-amounts">
                        <div class="col-label">Total Amount</div>
                        <div class="amount-total">₹ {{ sale.total_amount|default:0|floatformat:2 }}</div>
                        <div class="col-label mt-1">Paid Amount</div>
                        <div class="amount-paid">₹ {{ sale.advance_amount|default:0|floatformat:2 }}</div>
                        <div class="col-label mt-1">Balance Due</div>
                        <div class="amount-due {% if sale.balance_amount and sale.balance_amount > 0 %}has-due{% else %}zero{% endif %}">
                            ₹ {{ sale.balance_amount|default:0|floatformat:2 }}
                        </div>
                    </div>
                    <div class="action-col">
                        <a href="{% url 'sale_bill_details' sale.id %}" class="btn-view-ledger"><i class="bi bi-journal-text me-1"></i>View</a>
                        <div class="action-btns">
                            <a href="{% url 'bill_details_view' sale.id %}" class="action-btn edit" title="Edit"><i class="bi bi-pencil"></i></a>
                            <a href="{% url 'delete_sale' sale.id %}" class="action-btn delete" title="Delete" onclick="return confirm('Delete this sale?');"><i class="bi bi-trash"></i></a>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="entry-card text-center text-muted py-4">No sales found.</div>
                {% endfor %}
            </div>
        </div>
        {% block footer %}{% include 'partials/footer.html' %}{% endblock footer %}
    </div>
</div>
{% endblock content %}

{% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
{% endblock extra_js %}
