{% extends "partials/adminBase.html" %}
{% load static %}

{% block title %}Payment Ledger{% endblock title %}

{% block extra_css %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>
    <style>
        body { background-color: #f1f5f9; color: #334155; }
        .ledger-page .page-title { font-weight: 700; color: #1e293b; font-size: 1.5rem; margin-bottom: 1rem; margin-top: 1rem;}
        .ledger-page .summary-card {
            background: #151e31;
            border-radius: 10px;
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(26, 115, 232, 0.25);
        }
        .ledger-page .summary-card .label { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; color: rgba(255,255,255,0.9); letter-spacing: 0.05em; }
        .ledger-page .summary-card .value { font-size: 1.75rem; font-weight: 700; color: #fff; }
        .ledger-page .summary-card .icon-wrap {
            width: 40px; height: 40px;
            background: #fef3c7;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #d97706;
            font-weight: 700;
        }
        .ledger-page .filter-bar {
            background: #fff;
            border-radius: 12px;
            padding: 1rem 1.25rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
            border: 1px solid #e5e7eb;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 1rem;
            justify-content: space-between;
        }
        .ledger-page .filter-bar form { display: flex; flex-wrap: wrap; align-items: center; gap: 0.75rem; flex: 1; min-width: 0; }
        .ledger-page .filter-bar .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .ledger-page .filter-bar .filter-group-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }
        .ledger-page .filter-bar .filter-input {
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            color: #334155;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .ledger-page .filter-bar .filter-input:focus {
            outline: none;
            border-color: #FCA311;
            box-shadow: 0 0 0 2px rgba(252, 163, 17, 0.2);
        }
        .ledger-page .filter-bar .filter-input::placeholder { color: #94a3b8; }
        .ledger-page .filter-bar .filter-date { min-width: 142px; }
        .ledger-page .filter-bar .filter-to { color: #94a3b8; font-size: 0.8rem; font-weight: 500; }
        .ledger-page .filter-bar .filter-select {
            min-width: 140px;
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            color: #334155;
            cursor: pointer;
        }
        .ledger-page .filter-bar .filter-select:focus {
            outline: none;
            border-color: #FCA311;
        }
        .ledger-page .filter-bar .filter-search-wrap {
            position: relative;
            flex: 1;
            min-width: 200px;
            max-width: 280px;
        }
        .ledger-page .filter-bar .filter-search-wrap .bi-search {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            font-size: 1rem;
            pointer-events: none;
        }
        .ledger-page .filter-bar .filter-search {
            padding-left: 2.5rem;
            width: 100%;
            min-width: 180px;
        }
        .ledger-page .filter-bar .btn-search {
            background: #1e293b;
            color: #fff;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1.25rem;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        .ledger-page .filter-bar .btn-search:hover { background: #334155; color: #fff; }
        .ledger-page .filter-bar .btn-clear {
            background: transparent;
            color: #64748b;
            font-size: 0.8rem;
            font-weight: 500;
            border: none;
            padding: 0.5rem 0.75rem;
            text-decoration: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
        }
        .ledger-page .filter-bar .btn-clear:hover { color: #334155; }
        .ledger-page .btn-add {
            background: #FFC107;
            color: #1e293b;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            text-decoration: none;
        }
        .ledger-page .btn-add:hover { background: #e6ac00; color: #1e293b; }
        .ledger-page .entry-card {
            background: #fff;
            border-radius: 10px;
            padding: 1rem 1.25rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }
        .ledger-page .entry-card .col-date { min-width: 100px; }
        .ledger-page .entry-card .date-bold { font-weight: 700; color: #1e293b; font-size: 0.95rem; }
        .ledger-page .entry-card .id-badge {
            display: inline-block;
            background: #e0f2fe;
            color: #0369a1;
            padding: 0.2rem 0.5rem;
            border-radius: 6px;
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }
        .ledger-page .entry-card .col-party { min-width: 140px; }
        .ledger-page .entry-card .col-label { font-size: 0.7rem; font-weight: 600; text-transform: uppercase; color: #64748b; }
        .ledger-page .entry-card .party-name { font-weight: 700; color: #1e293b; }
        .ledger-page .entry-card .ref-text { font-size: 0.85rem; color: #64748b; }
        .ledger-page .entry-card .col-amounts { text-align: right; }
        .ledger-page .entry-card .amount-total { font-weight: 700; color: #1e293b; }
        .ledger-page .entry-card .type-badge { font-size: 0.8rem; font-weight: 600; }
        .ledger-page .entry-card .type-gave { color: #dc2626; }
        .ledger-page .entry-card .type-received { color: #16a34a; }
        .ledger-page .entry-card .col-payment { font-size: 0.85rem; color: #64748b; }
        .ledger-page .entry-card .col-actions { display: flex; flex-direction: column; align-items: flex-end; gap: 0.5rem; }
        .ledger-page .btn-view {
            background: #FFC107;
            color: #1e293b;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            padding: 0.4rem 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            font-size: 0.9rem;
            text-decoration: none;
        }
        .ledger-page .btn-view:hover { background: #e6ac00; color: #1e293b; }
        .ledger-page .icon-actions { display: flex; gap: 0.35rem; }
        .ledger-page .icon-actions a {
            width: 32px; height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            color: #64748b;
            text-decoration: none;
            transition: background 0.2s, color 0.2s;
        }
        .ledger-page .icon-actions a:hover { background: #f1f5f9; }
        .ledger-page .icon-actions .edit:hover { color: #ea580c; }
        .ledger-page .icon-actions .delete:hover { color: #dc2626; }
    </style>
{% endblock extra_css %}

{% block content %}
<div class="main-content ledger-page">
    <div class="page-content">
        <div class="container-fluid">
            <div class="container">
                <h2 class="page-title">Payment Ledger</h2>

                <div class="summary-card">
                    <div>
                        <div class="label">Total Payment Value</div>
                        <div class="value">₹ {{ total_payment_value|default:0|floatformat:2 }}</div>
                    </div>
                    <div class="icon-wrap"><i class="bi bi-currency-rupee"></i></div>
                </div>

                <div class="filter-bar">
                    <form method="get" action="">
                        <div class="filter-group">
                            <input type="date" name="date_from" value="{{ date_from }}" class="filter-input filter-date" id="date_from" aria-label="Start date">
                            <span class="filter-to">to</span>
                            <input type="date" name="date_to" value="{{ date_to }}" class="filter-input filter-date" id="date_to" aria-label="End date">
                        </div>
                        <select name="filter_type" class="filter-input filter-select" aria-label="Payment type">
                            <option value="">All Types</option>
                            <option value="gave" {% if filter_type == 'gave' %}selected{% endif %}>You Gave</option>
                            <option value="received" {% if filter_type == 'received' %}selected{% endif %}>You Received</option>
                        </select>
                        <div class="filter-search-wrap">
                            <i class="bi bi-search"></i>
                            <input type="text" name="search" value="{{ search }}" class="filter-input filter-search" placeholder="Search payment, customer, vendor..." aria-label="Search">
                        </div>
                        <button type="submit" class="btn-search"><i class="bi bi-search"></i> Search</button>
                        {% if date_from or date_to or filter_type or search %}
                        <a href="{% url 'list_payment' %}" class="btn-clear"><i class="bi bi-x-circle"></i> Clear</a>
                        {% endif %}
                    </form>
                    <a href="{% url 'add_payment' %}" class="btn-add"><i class="bi bi-plus-lg"></i> Add Payment</a>
                </div>

                {% for payment in data %}
                <div class="entry-card">
                    <div class="col-date">
                        <div class="date-bold">{{ payment.payment_date|date:"M d, Y" }}</div>
                        <span class="id-badge">#{{ payment.payment_number|default:payment.id }}</span>
                    </div>
                    <div class="col-party">
                        <div class="col-label">{% if payment.type == 'received' %}Customer{% else %}Vendor{% endif %}</div>
                        <div class="party-name">{% if payment.customer %}{{ payment.customer.name }}{% elif payment.vendor %}{{ payment.vendor.name }}{% else %}—{% endif %}</div>
                        <div class="ref-text">Type: <span class="type-badge {% if payment.type == 'gave' %}type-gave{% else %}type-received{% endif %}">{{ payment.get_type_display }}</span></div>
                    </div>
                    <div class="col-amounts">
                        <div class="col-label">Amount</div>
                        <div class="amount-total {% if payment.type == 'gave' %}type-gave{% else %}type-received{% endif %}">₹ {{ payment.amount|default:0|floatformat:2 }}</div>
                        <div class="col-label mt-1">Payment Mode</div>
                        <div class="col-payment">{{ payment.get_payment_type_display|default:"—" }}{% if payment.bank %} ({{ payment.bank.name }}){% endif %}</div>
                    </div>
                    <div class="col-actions">
                        <a href="{% url 'update_payment' payment.id %}" class="btn-view"><i class="bi bi-eye"></i> View</a>
                        <div class="icon-actions">
                            <a href="{% url 'update_payment' payment.id %}" class="edit" title="Edit"><i class="bi bi-pencil"></i></a>
                            <a href="{% url 'delete_payment' payment.id %}" class="delete" title="Delete" onclick="return confirm('Delete this payment?');"><i class="bi bi-trash"></i></a>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="entry-card text-center text-muted py-4">No payments found.</div>
                {% endfor %}
            </div>
        </div>
        {% block footer %}{% include 'partials/footer.html' %}{% endblock footer %}
    </div>
</div>
{% endblock content %}

{% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
{% endblock extra_js %}
