{% extends "partials/adminBase.html" %}
{% load static %}

{% block title %}Return / Exchange Requests{% endblock title %}

{% block extra_css %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
        body { background-color: #f1f5f9; color: #334155; }
        .exchange-list-page .card {
            background: #fff;
            border: none;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        .exchange-list-page .page-title { font-weight: 700; color: #1e293b; font-size: 1.25rem; }
        /* Filter card */
        .exchange-list-page .filter-card .form-label {
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 6px;
        }
        .exchange-list-page .filter-card .form-select {
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            min-width: 140px;
        }
        .exchange-list-page .btn-apply-filter {
            background-color: #FFC107;
            color: #000;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            padding: 6px 16px;
        }
        .exchange-list-page .btn-apply-filter:hover { background-color: #e6ac00; color: #000; }
        .exchange-list-page .btn-clear-filter {
            background: #fff;
            border: 1px solid #e2e8f0;
            color: #64748b;
            border-radius: 6px;
            padding: 6px 16px;
        }
        .exchange-list-page .btn-clear-filter:hover { background: #f8fafc; color: #475569; }
        /* Table */
        .exchange-list-page .exchange-table { margin-bottom: 0; background: #fff; }
        .exchange-list-page .exchange-table thead th {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            color: #334155;
            background: #fff;
            border-bottom: 1px solid #e2e8f0;
            padding: 12px 10px;
        }
        .exchange-list-page .exchange-table tbody td {
            padding: 12px 10px;
            vertical-align: middle;
            color: #334155;
            background: #fff;
            border-bottom: 1px solid #e2e8f0;
        }
        .exchange-list-page .exchange-table tbody tr:hover td { background: #f8fafc; }
        .exchange-list-page .request-id { color: #64748b; font-size: 13px; }
        .exchange-list-page .product-name { font-weight: 600; color: #1e293b; }
        .exchange-list-page .user-name { font-weight: 600; color: #1e293b; display: block; }
        .exchange-list-page .date-line { font-weight: 500; color: #334155; }
        .exchange-list-page .time-line { font-size: 12px; color: #64748b; }
        .exchange-list-page .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }
        .exchange-list-page .status-badge.status-approved { color: #166534; background: #dcfce7; border: 1px solid #bbf7d0; }
        .exchange-list-page .status-badge.status-rejected { color: #b91c1c; background: #fee2e2; border: 1px solid #fecaca; }
        .exchange-list-page .status-badge.status-requested { color: #b45309; background: #fef3c7; border: 1px solid #fde68a; }
        .exchange-list-page .status-badge.status-completed { color: #1d4ed8; background: #dbeafe; border: 1px solid #bfdbfe; }
        .exchange-list-page .status-badge.status-other { color: #475569; background: #f1f5f9; border: 1px solid #e2e8f0; }
        .exchange-list-page .btn-view {
            display: inline-block;
            background: #fff;
            color: #2563eb !important;
            border: 1px solid #2563eb;
            border-radius: 6px;
            padding: 6px 14px;
            font-size: 13px;
            font-weight: 600;
            text-decoration: none !important;
            cursor: pointer;
            white-space: nowrap;
            transition: background 0.2s, color 0.2s;
        }
        .exchange-list-page .btn-view:hover {
            background: #eff6ff !important;
            color: #1d4ed8 !important;
            border-color: #1d4ed8;
        }
        .exchange-list-page .type-badge {
            display: inline-flex;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            font-weight: 500;
            background: #f1f5f9;
            color: #1e293b;
        }
        @media (max-width: 768px) { .table-responsive { overflow-x: auto; } }
    </style>
{% endblock extra_css %}

{% block content %}
<div class="main-content exchange-list-page">
    <div class="page-content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                        <h4 class="mb-sm-0 page-title">Return / Exchange Requests</h4>
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="card mb-3 filter-card">
                            <div class="card-body">
                                <form method="get" action="" class="row g-3 align-items-end">
                                    <div class="col-auto">
                                        <label for="filter_status" class="form-label">Status</label>
                                        <select name="status" id="filter_status" class="form-select form-select-sm">
                                            <option value="">All Requests</option>
                                            <option value="requested" {% if filter_status == 'requested' %}selected{% endif %}>Requested</option>
                                            <option value="approved" {% if filter_status == 'approved' %}selected{% endif %}>Approved</option>
                                            <option value="rejected" {% if filter_status == 'rejected' %}selected{% endif %}>Rejected</option>
                                            <option value="completed" {% if filter_status == 'completed' %}selected{% endif %}>Completed</option>
                                        </select>
                                    </div>
                                    <div class="col-auto">
                                        <label for="filter_type" class="form-label">Type</label>
                                        <select name="type" id="filter_type" class="form-select form-select-sm">
                                            <option value="">All</option>
                                            <option value="return" {% if filter_type == 'return' %}selected{% endif %}>Return</option>
                                            <option value="exchange" {% if filter_type == 'exchange' %}selected{% endif %}>Exchange</option>
                                        </select>
                                    </div>
                                    <div class="col-auto">
                                        <button type="submit" class="btn btn-apply-filter">Apply Filter</button>
                                        <a href="{% url 'order_exchange_list' %}" class="btn btn-clear-filter">Clear</a>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table exchange-table">
                                        <thead>
                                            <tr>
                                                <th>#</th>
                                                <th>ORDER ITEM</th>
                                                <th>USER</th>
                                                <th>TYPE</th>
                                                <th>STATUS</th>
                                                <th>REQUESTED ON</th>
                                                <th>ACTION</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% if data %}
                                                {% for i in data %}
                                                    <tr>
                                                        <td class="request-id">{{ forloop.counter }}</td>
                                                        <td>
                                                            <span class="product-name">{{ i.order_item.product.name }} × {{ i.order_item.quantity }}</span>
                                                        </td>
                                                        <td>
                                                            <span class="user-name">{{ i.user.get_full_name|default:i.user.username }}</span>
                                                        </td>
                                                        <td>
                                                            <span class="type-badge">{{ i.get_type_display }}</span>
                                                        </td>
                                                        <td>
                                                            {% with status=i.order_item.status %}
                                                            <span class="status-badge
                                                                {% if 'approved' in status or 'replaced_approved' in status %}status-approved
                                                                {% elif 'rejected' in status %}status-rejected
                                                                {% elif 'requested' in status %}status-requested
                                                                {% elif 'completed' in status or 'replacement_completed' in status %}status-completed
                                                                {% else %}status-other{% endif %}">
                                                                {% if 'approved' in status or 'replaced_approved' in status %}Approved
                                                                {% elif 'rejected' in status %}Rejected
                                                                {% elif 'requested' in status %}Requested
                                                                {% elif 'completed' in status or 'replacement_completed' in status %}Completed
                                                                {% else %}{{ status|default:"—" }}{% endif %}
                                                            </span>
                                                            {% endwith %}
                                                        </td>
                                                        <td>
                                                            <span class="date-line">{{ i.created_at|date:"d M Y" }}</span><br>
                                                            <span class="time-line">{{ i.created_at|time:"g:i A" }}</span>
                                                        </td>
                                                        <td>
                                                            <a href="{% url 'return_detail' i.id %}" class="btn-view">View</a>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            {% else %}
                                                <tr><td colspan="7" class="text-center py-4 text-muted">No requests found.</td></tr>
                                            {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% block footer %}
            {% include 'partials/footer.html' %}
        {% endblock footer %}
    </div>
</div>
{% endblock content %}

{% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
{% endblock extra_js %}
