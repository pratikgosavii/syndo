{% extends "partials/adminBase.html" %}
{% load static %}

{% block title %}Add Payment{% endblock title %}

{% block extra_css %}
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<style>
  body {
    background-color: #f0d28c;
    padding-bottom: 20px;
  }

  .form-container {
    background-color: #fff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .section-card {
    background: #fff8eb;
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 15px;
  }

  .section-card h6 {
    font-weight: bold;
    margin-bottom: 5px;
  }

  .btn-warning {
    background-color: #f0b23a;
    border-color: #f0b23a;
    color: #fff;
  }

  .btn-outline-dark {
    border: 1px solid #444;
    color: #444;
  }

  .btn-outline-dark:hover {
    background: #f0b23a;
    color: #fff;
  }

  .custom-button {
    width: 100%;
    font-weight: bold;
    border-radius: 8px;
    margin-top: 20px;
  }
</style>
{% endblock extra_css %}

{% block content %}
<div class="main-content">
  <div class="page-content">
    <div class="container-fluid">
      <!-- Page Title -->
      <div class="row">
        <div class="col-12">
          <div
            class="page-title-box d-sm-flex align-items-center justify-content-between"
          >
            <h4 class="mb-sm-0 font-size-18">Add Payment</h4>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="form-container">
          <form method="POST">
            {% csrf_token %}

            <!-- Invoice Info -->
            <div class="section-card">
              <h6>Payment ID: PAY-1</h6>
              <p class="mb-0">14-02-2025</p>
            </div>

            <div class="mb-3">
                <label class="form-label d-block">Type</label>
                <div class="btn-group" role="group">
                    <input type="radio" class="btn-check" name="type" id="gave" value="gave" checked>
                    <label class="btn btn-outline-warning" for="gave">You Gave</label>

                    <input type="radio" class="btn-check" name="type" id="received" value="received">
                    <label class="btn btn-outline-warning" for="received">You Received</label>
                </div>
            </div>

                <!-- Party -->
            <div class="mb-3">
                <label class="form-label d-block">Party</label>
                <div class="btn-group" role="group">
                    <input type="radio" class="btn-check" name="party" id="party-customer" value="customer" checked>
                    <label class="btn btn-outline-warning" for="party-customer">Customer</label>

                    <input type="radio" class="btn-check" name="party" id="party-vendor" value="vendor">
                    <label class="btn btn-outline-warning" for="party-vendor">Vendor</label>
                </div>
            </div>

                <!-- Select Party -->
            <div class="mb-3" id="customer-dropdown">
                <label class="form-label">Select Customer</label>
                <select name="customer" class="form-select">
                    <option value="">Search</option>
                    {% for c in customers %}
                    <option value="{{ c.id }}">{{ c.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3" id="vendor-dropdown" style="display:none;">
                <label class="form-label">Select Vendor</label>
                <select name="vendor" class="form-select">
                    <option value="">Search</option>
                    {% for v in vendors %}
                    <option value="{{ v.id }}">{{ v.name }}</option>
                    {% endfor %}
                </select>
            </div>

                <!-- Amount -->
            <div class="mb-3">
                <label class="form-label">Amount</label>
                <input type="number" step="0.01" name="amount" class="form-control" placeholder="Enter here">
            </div>

                <!-- Payment Date -->
            <div class="mb-3">
                <label class="form-label">Payment Date</label>
                <input type="date" name="payment_date" class="form-control">
            </div>

                <!-- Select Type -->
            <div class="mb-3">
                <label class="form-label d-block">Select Type <span class="text-danger">*</span></label>
                <div class="btn-group flex-wrap" role="group" aria-label="Payment method">
                    {% for key, val in form.fields.payment_type.choices %}
                        {% if key %}  {# skip blank/---- option #}
                            <button type="button" 
                                    class="btn {% if form.instance.payment_type == key %}btn-warning{% else %}btn-outline-dark{% endif %} me-1 mb-1"
                                    onclick="selectPayment('{{ key }}', this)">
                                {{ val }}
                            </button>
                        {% endif %}
                    {% endfor %}
                </div>
                <!-- Hidden field to actually submit the value -->
                <input type="hidden" name="payment_type" id="payment_type" value="{{ form.instance.payment_type|default:'cash' }}">
            </div>


                <!-- Select Account -->
            <div class="mb-3" id="bank-dropdown">
                <label class="form-label">Select Bank</label>
                 {{ form.bank }}
                    {% if form.bank.errors %}
                      <div class="text-danger">{{ form.bank.errors.0 }}</div>
                    {% endif %}
            </div>

                <!-- Notes -->
            <div class="mb-3">
                <label class="form-label">Notes</label>
                <textarea name="notes" class="form-control" rows="2" placeholder="Expense Description"></textarea>
            </div>

                <!-- Attachments -->
            <div class="mb-3">
                <label class="form-label">Attachments</label><br>
                <button type="button" class="btn btn-outline-dark me-2"><i class="bi bi-camera"></i> Camera</button>
                <input type="file" name="attachment" class="form-control d-inline-block w-auto">
            </div>

            <!-- Submit Button -->
            <div class="text-center">
              <button type="submit" class="btn btn-warning custom-button">
                Proceed
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}

{% block extra_js %}
<script>
  function selectPayment(method, btn) {
    document.getElementById("payment_type").value = method;
    console.log('---------')
    console.log(method)
    // reset button styles
    btn.closest(".btn-group")
      .querySelectorAll("button")
      .forEach((b) =>
        b.classList.replace("btn-warning", "btn-outline-dark")
      );
    btn.classList.replace("btn-outline-dark", "btn-warning");

    const bankDropdown = document.getElementById("bank-dropdown");
    if (method === "bank") {
      bankDropdown.style.display = "block";
      document.getElementById("id_bank").setAttribute("required", "required");
    } else {
      bankDropdown.style.display = "none";
      document.getElementById("id_bank").removeAttribute("required");
      document.getElementById("id_bank").value = "";
    }
  }
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const customerDropdown = document.getElementById("customer-dropdown");
    const vendorDropdown = document.getElementById("vendor-dropdown");
    const partyRadios = document.querySelectorAll("input[name='party']");

    partyRadios.forEach(radio => {
      radio.addEventListener("change", function () {
        if (this.value === "customer") {
          customerDropdown.style.display = "block";
          vendorDropdown.style.display = "none";
        } else {
          customerDropdown.style.display = "none";
          vendorDropdown.style.display = "block";
        }
      });
    });
  });
</script>


{% endblock extra_js %}
