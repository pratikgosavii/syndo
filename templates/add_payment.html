{% extends "partials/adminBase.html" %}
{% load static %}

{% block title %}Add Payment{% endblock title %}

{% block extra_css %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
<style>
  body { background-color: #f8f9fa; padding-bottom: 20px; }
  .form-container { background-color: #fff; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
  .section-card { background: #fff8eb; padding: 12px; border-radius: 8px; margin-bottom: 15px; }
  .section-card h6 { font-weight: bold; margin-bottom: 5px; }
  .payment-section-card { border: 1px solid #eee; border-radius: 10px; margin-bottom: 1.5rem; background: #fff; overflow: hidden; }
  .payment-section-card .payment-section-header { background: #FEEEC3; padding: 12px 1.25rem; font-weight: 700; color: #1a1a1a; font-size: 1rem; }
  .payment-section-card .payment-section-header .bi { margin-right: 0.5rem; opacity: 0.9; }
  .payment-section-card .payment-section-body { padding: 1.25rem; }
  .btn-payment { background: #fff; border: 1px solid #dee2e6; color: #495057; }
  .btn-payment.btn-payment-active { background-color: #FFA500; border-color: #FFA500; color: #fff; }
  .btn-payment:not(.btn-payment-active):hover { border-color: #FFA500; color: #FFA500; }
  .btn-warning { background-color: #FFA500; border-color: #FFA500; color: #fff; }
  .btn-outline-warning { border-color: #FFA500; color: #FFA500; }
  .btn-outline-warning:hover { background: #FFA500; color: #fff; }
  .custom-button { width: 100%; font-weight: bold; border-radius: 8px; margin-top: 20px; background-color: #775599; border-color: #775599; }
  .custom-button:hover { background-color: #5e4477; border-color: #5e4477; color: #fff; }
</style>
{% endblock extra_css %}

{% block content %}
<div class="main-content">
  <div class="page-content">
    <div class="container-fluid">
      <!-- Page Title -->
      <div class="row">
        <div class="col-12">
          <div
            class="page-title-box d-sm-flex align-items-center justify-content-between"
          >
            <h4 class="mb-sm-0 font-size-18"><i class="bi bi-wallet2 me-2" style="color: #775599;"></i>Add Payment</h4>
          </div>
        </div>
      </div>

      <div class="container">
        <div class="form-container">
          <form method="POST">
            {% csrf_token %}

            <!-- Invoice Info -->
            <div class="section-card">
              <h6>Payment ID: PAY-1</h6>
              <p class="mb-0">14-02-2025</p>
            </div>

            <div class="mb-3">
                <label class="form-label d-block">Type</label>
                <div class="btn-group" role="group">
                    <input type="radio" class="btn-check" name="type" id="gave" value="gave" checked>
                    <label class="btn btn-outline-warning" for="gave">You Gave</label>

                    <input type="radio" class="btn-check" name="type" id="received" value="received">
                    <label class="btn btn-outline-warning" for="received">You Received</label>
                </div>
            </div>

                <!-- Party -->
            <div class="mb-3">
                <label class="form-label d-block">Vendor</label>
                <div class="btn-group" role="group">
                    <input type="radio" class="btn-check" name="vendor" id="vendor-customer" value="customer" checked>
                    <label class="btn btn-outline-warning" for="vendor-customer">Customer</label>

                    <input type="radio" class="btn-check" name="vendor" id="vendor-vendor" value="vendor">
                    <label class="btn btn-outline-warning" for="vendor-vendor">Vendor</label>
                </div>
            </div>

                <!-- Select Party -->
            <div class="mb-3" id="customer-dropdown">
                <label class="form-label">Select Customer</label>
                {{ form.customer }}
            </div>

            <div class="mb-3" id="vendor-dropdown" style="display:none;">
                <label class="form-label">Select Vendor</label>
                {{ form.vendor }}
                
            </div>

                <!-- Amount -->
            <div class="mb-3">
                <label class="form-label">Amount</label>
                <input type="number" step="0.01" name="amount" class="form-control" placeholder="Enter here">
            </div>

            <!-- Payment (card with orange/yellow header + orange active button) -->
            <div class="payment-section-card">
              <div class="payment-section-header"><i class="bi bi-credit-card"></i>Payment</div>
              <div class="payment-section-body">
                <div class="mb-3">
                  <label class="form-label">Payment Date</label>
                  {{ form.payment_date }}
                </div>
                <div class="mb-3">
                  <label class="form-label d-block">Payment type <span class="text-danger">*</span></label>
                  <div class="btn-group btn-group-sm" role="group" aria-label="Payment method">
                    <button type="button" class="btn btn-payment {% if form.instance.payment_type == 'cash' %}btn-payment-active{% endif %}" onclick="selectPayment('cash', this)"><i class="bi bi-cash me-1"></i>Cash</button>
                    <button type="button" class="btn btn-payment {% if form.instance.payment_type == 'upi' %}btn-payment-active{% endif %}" onclick="selectPayment('upi', this)"><i class="bi bi-phone me-1"></i>UPI</button>
                    <button type="button" class="btn btn-payment {% if form.instance.payment_type == 'cheque' %}btn-payment-active{% endif %}" onclick="selectPayment('cheque', this)"><i class="bi bi-bank me-1"></i>Cheque</button>
                  </div>
                  <input type="hidden" name="payment_type" id="payment_type" value="{{ form.instance.payment_type|default:'cash' }}">
                </div>
                <div class="mb-3" id="bank-dropdown" style="display:none">
                  <label class="form-label">Select Bank</label>
                  {{ form.bank }}
                  {% if form.bank.errors %}<div class="text-danger">{{ form.bank.errors.0 }}</div>{% endif %}
                </div>
              </div>
            </div>

                <!-- Notes -->
            <div class="mb-3">
                <label class="form-label">Notes</label>
                <textarea name="notes" class="form-control" rows="2" placeholder="Expense Description"></textarea>
            </div>

                <!-- Attachments -->
            <div class="mb-3">
                <label class="form-label">Attachments</label><br>
                <input type="file" name="attachment" class="form-control d-inline-block w-auto">
            </div>

            <!-- Submit Button -->
            <div class="text-center">
              <button type="submit" class="btn btn-warning custom-button"><i class="bi bi-check-lg me-1"></i>Proceed</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}

{% block extra_js %}
<script>
  function selectPayment(method, btn) {
    document.getElementById('payment_type').value = method;
    var group = btn.closest('.btn-group');
    if (group) group.querySelectorAll('.btn-payment').forEach(function(b) { b.classList.remove('btn-payment-active'); });
    btn.classList.add('btn-payment-active');
    var bankDropdown = document.getElementById('bank-dropdown');
    var bankSelect = document.getElementById('id_bank');
    if (method !== 'cash') {
      if (bankDropdown) bankDropdown.style.display = 'block';
      if (bankSelect) { bankSelect.setAttribute('required', 'required'); }
    } else {
      if (bankDropdown) bankDropdown.style.display = 'none';
      if (bankSelect) { bankSelect.removeAttribute('required'); bankSelect.value = ''; }
    }
  }
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var paymentTypeEl = document.getElementById("payment_type");
    if (paymentTypeEl) {
      var paymentType = paymentTypeEl.value;
      var btn = document.querySelector("[onclick*=\"selectPayment('" + paymentType + "'\"]");
      if (btn) selectPayment(paymentType, btn);
    }
    const customerDropdown = document.getElementById("customer-dropdown");
    const vendorDropdown = document.getElementById("vendor-dropdown");
    const vendorRadios = document.querySelectorAll("input[name='vendor']");
    vendorRadios.forEach(radio => {
      radio.addEventListener("change", function () {
        if (this.value === "customer") {
          customerDropdown.style.display = "block";
          vendorDropdown.style.display = "none";
        } else {
          customerDropdown.style.display = "none";
          vendorDropdown.style.display = "block";
        }
      });
    });
  });
</script>


{% endblock extra_js %}
